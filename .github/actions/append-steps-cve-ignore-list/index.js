const fs = require('fs');
const os = require('os');
const newline = os.EOL;
const filePath = ".trivyignore";
const core = require('@actions/core');

const cves = [
    'CVE-2023-5981', // Fixed version not yet available in Debian
    'CVE-2024-0567', // Fixed version not yet available in Debian
    'CVE-2023-6597', // Python 3.11.9 is not available yet
    'CVE-2024-0450', // Python 3.11.9 is not available yet
    'CVE-2024-4030', // We are not using Windows
    'CVE-2024-4032', // IP Private Address Space does not impact us
    'CVE-2024-6345', // Cannot be fixed. Slow.
    'CVE-2024-6923', // We don't use the Python email module
    'CVE-2024-7592', // We don't use the Python email module
    'CVE-2024-8088', // We don't use zipfile
    'CVE-2024-9287', // Venv is not used in prod
    'CVE-2024-12254', // Minor issues in Python
    'CVE-2025-0938', // Minor issues in Python
    'CVE-2024-3220', // We are not using Windows
];

content = newline + cves.join(newline) + newline;
console.log('Appending the following CVEs to .trivyignore:', content);

fs.appendFile(filePath, content, { flag: 'a', flush: true}, (err) => {
    if (err) {
        console.error('Error writing to file:', err);
        core.setFailed('Error writing the .trivyignore to file. Reason:' + err.message);
    } else {
        console.log('CVEs appended successfully.');
    }
});